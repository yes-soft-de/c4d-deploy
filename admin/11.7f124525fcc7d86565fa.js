(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"Gw/Z":function(e,t,s){"use strict";s.r(t),s.d(t,"MessagesModule",function(){return I});var n=s("vTDv"),o=s("tyNb"),i=s("ofXK"),r=s("3Pt+"),a=s("XNiG"),c=s("fXoL"),l=s("EWl0"),d=s("tk/3"),h=s("ytdW"),g=s("I/3d");let m=(()=>{class e{constructor(e,t,s,n){this.datePipe=e,this.httpClient=t,this.tokenService=s,this.firestore=n}sendMessage(e,t,s){const n={msg:{message:t},sender:s,sentDate:this.datePipe.transform(new Date,"yyyy-MM-dd HH:mm:ss","TZD").toString()};this.firestore.collection("chat_rooms").doc(e).collection("messages").add(n)}requestGetMessages(e){if(e)return this.firestore.collection("chat_rooms").doc(e).collection("messages").snapshotChanges()}sendNotificationToReportFromAdmin(e){return this.httpClient.post(l.a.notificationToReportAPI,{roomID:e},this.tokenService.httpOptions())}sendNotificationToCaptainFromAdmin(e){return this.httpClient.post(l.a.notificationtoCaptainAPI,{roomID:e},this.tokenService.httpOptions())}notificationToOwnerFromAdmin(e){return this.httpClient.post(l.a.notificationToOwnerAPI,{roomID:e},this.tokenService.httpOptions())}}return e.\u0275fac=function(t){return new(t||e)(c.cc(i.e),c.cc(d.a),c.cc(h.a),c.cc(g.a))},e.\u0275prov=c.Pb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var u=s("W9AH"),b=s("ijy7"),p=s("sYmb"),f=s("5eHb");function y(e,t){if(1&e&&(c.Wb(0),c.Yb(1,"p",12),c.Dc(2),c.Ub(3,"br"),c.Yb(4,"span",13),c.Dc(5),c.ic(6,"date"),c.Xb(),c.Xb(),c.Vb()),2&e){const e=c.hc().$implicit;c.Gb(2),c.Fc(" ",null!=e&&null!=e.msg&&e.msg.message?null==e||null==e.msg?null:e.msg.message:null==e?null:e.msg,""),c.Gb(3),c.Ec(c.kc(6,2,null!=e&&null!=e.sentDate&&e.sentDate.seconds?null==e||null==e.sentDate?null:e.sentDate.seconds:null==e?null:e.sentDate,"h:mm a"))}}function v(e,t){if(1&e&&(c.Wb(0),c.Yb(1,"p",14),c.Dc(2),c.Ub(3,"br"),c.Yb(4,"span",13),c.Dc(5),c.ic(6,"date"),c.Xb(),c.Xb(),c.Vb()),2&e){const e=c.hc().$implicit;c.Gb(2),c.Fc(" ",null!=e&&null!=e.msg&&e.msg.message?null==e||null==e.msg?null:e.msg.message:null==e?null:e.msg,""),c.Gb(3),c.Ec(c.kc(6,2,null!=e&&null!=e.sentDate&&e.sentDate.seconds?null==e||null==e.sentDate?null:e.sentDate.seconds:null==e?null:e.sentDate,"h:mm a"))}}function C(e,t){if(1&e&&(c.Wb(0),c.Cc(1,y,7,5,"ng-container",11),c.Cc(2,v,7,5,"ng-container",11),c.Vb()),2&e){const e=t.$implicit,s=c.hc();c.Gb(1),c.oc("ngIf",e.sender==s.secondSender),c.Gb(1),c.oc("ngIf",e.sender==s.firstSender)}}let D=(()=>{class e{constructor(e,t,s,n,o,i,r,c,l,d){this.messageService=e,this.captainService=t,this.orderService=s,this.translate=n,this.ngZone=o,this.formBuilder=i,this.toaster=r,this.render=c,this.document=l,this.activatedRoute=d,this.destroy$=new a.a}ngOnInit(){this.isReportChat=!1,this.isCaptainChat=!1,this.getNewLanguage(),this.checkMessageBodyScrollHeight(),this.checkChangingLanguage(),this.messageForm=this.formBuilder.group({message:["",r.q.required],roomId:[""]}),this.activatedRoute.params.subscribe(e=>{"owner"==e.client&&(this.isOwnerChat=!0,this.roomID=e.uuid,this.runRequestGetMessages(e.uuid,this.ngZone)),"captain"==e.client&&this.captainService.captainDetails(Number(e.id)).subscribe(e=>{console.log("Captain Room ID",e.Data.uuid),e.Data.uuid&&(this.isCaptainChat=!0,this.roomID=e.Data.uuid,this.runRequestGetMessages(e.Data.uuid,this.ngZone))}),"order"==e.client&&this.orderService.orderDetails(Number(e.id)).subscribe(e=>{e.Data.uuid&&(console.log("Order Room ID : ",e.Data.uuid),this.roomID=e.Data.uuid,this.runRequestGetMessages(e.Data.uuid,this.ngZone))}),"report"==e.client&&(console.log("Report Room ID : ",e.uuid),this.isReportChat=!0,this.roomID=e.uuid,this.runRequestGetMessages(e.uuid,this.ngZone))})}runRequestGetMessages(e,t){e&&(this.messageForm.get("roomId").setValue(e),this.messageRequestSubscription=this.messageService.requestGetMessages(e).subscribe(e=>{if(this.messages=e.map(e=>({msg:e.payload.doc.data().msg,sender:e.payload.doc.data().sender,sentDate:e.payload.doc.data().sentDate})),console.log("messages : ",this.messages),this.messages.sort((e,t)=>e.sentDate.localeCompare(t.sentDate)),this.messages.length>0){this.secondSender="admin";for(let e=0;e<this.messages.length;e++)null==this.firstSender&&this.messages[e].sender!=this.secondSender&&(this.firstSender=this.messages[e].sender)}},e=>console.log("Error ",e),()=>{if(this.messages.sort((e,t)=>e.sentDate.localeCompare(t.sentDate)),console.log("after sort Messages : ",this.messages),this.messages.length>0){this.secondSender="admin";for(let e=0;e<this.messages.length-1;e++)null==this.firstSender&&this.messages[e].sender!=this.secondSender&&(this.firstSender=this.messages[e].sender);console.log("firstSender : ",this.firstSender),console.log("secondSender : ",this.secondSender)}}))}checkChangingLanguage(){if(location.href.split("/").includes("chat")&&"ar"==this.currentLanguage){const e=setInterval(()=>{const t=this.document.querySelector(".chat-submit");console.log("messageBody is exists",t),t&&(this.render.setStyle(t,"border-top-left-radius","5px"),this.render.setStyle(t,"border-bottom-left-radius","5px"),this.render.setStyle(t,"border-top-right-radius","0"),this.render.setStyle(t,"border-bottom-right-radius","0"),clearInterval(e))},100)}}getNewLanguage(){this.currentLanguage=this.translate.currentLang,this.translate.onLangChange.subscribe(e=>{this.currentLanguage=e.lang,console.log("languages change to : ",this.currentLanguage),this.checkChangingLanguage()})}checkMessageBodyScrollHeight(){this.bodyScrollHeightInterval=setInterval(()=>{const e=this.document.querySelector(".messages-body");e.scrollHeight>e.clientHeight&&(e.scrollTop=e.scrollHeight,clearInterval(this.bodyScrollHeightInterval))},100)}checkMessageDirectionForRtl(){const e=setInterval(()=>{const t=this.document.querySelector(".messages-body");t.scrollHeight>40&&(t.scrollTop=t.scrollHeight,clearInterval(e))},100)}ngOnDestroy(){clearInterval(this.bodyScrollHeightInterval),this.isReportChat=!1,this.isCaptainChat=!1,this.isOwnerChat=!1,this.messageRequestSubscription.unsubscribe(),this.destroy$.next(),this.destroy$.complete()}onSubmit(){if(this.messageForm.valid){console.log("roomID : ",this.roomID);const e=this.messageForm.getRawValue();this.isReportChat&&this.messageService.sendNotificationToReportFromAdmin(this.roomID).subscribe(e=>console.log("send notification : ",e)),this.isCaptainChat&&this.messageService.sendNotificationToCaptainFromAdmin(this.roomID).subscribe(e=>console.log("send notification : ",e)),this.isOwnerChat&&this.messageService.notificationToOwnerFromAdmin(this.roomID).subscribe(e=>console.log("send notification : ",e)),console.log(e),e.roomId?this.messageService.sendMessage(e.roomId,e.message,"admin"):this.toaster.error("Error, Please Try Later"),this.messageForm.reset()}else this.toaster.error("Error : Can't Send An Empty Message")}}return e.\u0275fac=function(t){return new(t||e)(c.Tb(m),c.Tb(u.a),c.Tb(b.a),c.Tb(p.d),c.Tb(c.E),c.Tb(r.b),c.Tb(f.b),c.Tb(c.K),c.Tb(i.d),c.Tb(o.a))},e.\u0275cmp=c.Nb({type:e,selectors:[["app-chat"]],decls:17,vars:12,consts:[[1,"messages"],[1,"container"],[1,"bg-light-blue","text-white","font-weight-bold","p-3"],[1,"col-12","col-md-8","mx-auto","border","mt-4"],[1,"messages-body","my-3","pt-3","p-2"],[4,"ngFor","ngForOf"],[1,"",3,"formGroup","ngSubmit"],[1,"input-group","mb-3"],["type","text","name","message","formControlName","message","aria-label","Type here","aria-describedby","basic-addon2",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"btn","btn-primary","chat-submit",3,"disabled"],[4,"ngIf"],[1,"col-12","col-sm-11","col-md-10","recieved-message","text-white","py-1","px-2","rounded","bg-grey-blue","ml-custom-auto"],[1,"message-time"],[1,"col-12","col-sm-11","col-md-10","recieved-message","text-white","py-1","px-2","rounded","bg-light-blue","mr-custom-auto"]],template:function(e,t){1&e&&(c.Yb(0,"div",0),c.Yb(1,"div",1),c.Yb(2,"h1",2),c.Dc(3),c.ic(4,"translate"),c.Xb(),c.Yb(5,"div",3),c.Yb(6,"div",4),c.Cc(7,C,3,2,"ng-container",5),c.Xb(),c.Ub(8,"div"),c.Yb(9,"form",6),c.fc("ngSubmit",function(){return t.onSubmit()}),c.Yb(10,"div",7),c.Ub(11,"input",8),c.ic(12,"translate"),c.Yb(13,"div",9),c.Yb(14,"button",10),c.Dc(15),c.ic(16,"translate"),c.Xb(),c.Xb(),c.Xb(),c.Xb(),c.Xb(),c.Xb(),c.Xb()),2&e&&(c.Gb(3),c.Ec(c.jc(4,6,"chat-room")),c.Gb(4),c.oc("ngForOf",t.messages),c.Gb(2),c.oc("formGroup",t.messageForm),c.Gb(2),c.pc("placeholder",c.jc(12,8,"type-here")),c.Gb(3),c.oc("disabled",!t.messageForm.valid),c.Gb(1),c.Ec(c.jc(16,10,"send")))},directives:[i.l,r.s,r.i,r.f,r.a,r.h,r.d,i.m],pipes:[p.c,i.e],styles:["@media (min-width:992px) and (max-width:1199px){.messages[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.2rem}}@media (min-width:768px) and (max-width:991px){.messages[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}}@media (min-width:576px) and (max-width:767px){.messages[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;background:none!important;color:#21a5b8!important}}@media (max-width:575px){.messages[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;background:none!important;color:#21a5b8!important}}.messages-body[_ngcontent-%COMP%]{height:70vh;max-height:70vh;overflow-y:scroll;direction:ltr}.messages-body[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.messages-body[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.messages-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#ccc}.messages-body[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#aaa}.messages-body[_ngcontent-%COMP%]   .recieved-message[_ngcontent-%COMP%]{width:-webkit-max-content;width:max-content}.messages-body[_ngcontent-%COMP%]   .recieved-message[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{font-size:.7rem;font-weight:100}"]}),e})();const S=[{path:"view/:client/:id",component:D},{path:"view/:client/:id/:uuid",component:D}];let w=(()=>{class e{}return e.\u0275mod=c.Rb({type:e}),e.\u0275inj=c.Qb({factory:function(t){return new(t||e)},imports:[[o.e.forChild(S)],o.e]}),e})(),I=(()=>{class e{}return e.\u0275mod=c.Rb({type:e}),e.\u0275inj=c.Qb({factory:function(t){return new(t||e)},providers:[m,i.e],imports:[[n.a,w]]}),e})()}}]);